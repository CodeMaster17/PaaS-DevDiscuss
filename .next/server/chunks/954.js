"use strict";exports.id=954,exports.ids=[954],exports.modules={60954:(e,t,a)=>{a.r(t),a.d(t,{createUser:()=>createUser,deleteUser:()=>deleteUser,getAllUsers:()=>getAllUsers,getSavedQuestions:()=>getSavedQuestions,getUserAnswers:()=>getUserAnswers,getUserById:()=>getUserById,getUserInfo:()=>getUserInfo,getUserQuestions:()=>getUserQuestions,toggleSaveQuestion:()=>toggleSaveQuestion,updateUser:()=>updateUser});var s=a(10459),o=a(18886),r=a(78291),n=a(50561),c=a(7427),l=a(48275),i=a(95639),u=a(35082);async function getUserById(e){try{(0,r.v)();let{userId:t}=e,a=await o.Z.findOne({clerkId:t});return a}catch(e){throw console.log(e),e}}async function createUser(e){try{(0,r.v)();let t=await o.Z.create(e);return t}catch(e){throw console.log(e),e}}async function updateUser(e){try{(0,r.v)();let{clerkId:t,updateData:a,path:s}=e;await o.Z.findOneAndUpdate({clerkId:t},a,{new:!0}),(0,n.revalidatePath)(s)}catch(e){throw console.log(e),e}}async function deleteUser(e){try{(0,r.v)();let{clerkId:t}=e,a=await o.Z.findOneAndDelete({clerkId:t});if(!a)throw Error("User not found");await c.Z.deleteMany({author:a._id});let s=await o.Z.findByIdAndDelete(a._id);return s}catch(e){throw console.log(e),e}}async function getAllUsers(e){try{(0,r.v)();let{searchQuery:t,filter:a,page:s=1,pageSize:n=10}=e,c=(s-1)*n,l={};t&&(l.$or=[{name:{$regex:RegExp(t,"i")}},{username:{$regex:RegExp(t,"i")}}]);let i={};switch(a){case"new_users":i={joinedAt:-1};break;case"old_users":i={joinedAt:1};break;case"top_contributors":i={reputation:-1}}let u=await o.Z.find(l).sort(i).skip(c).limit(n),d=await o.Z.countDocuments(l),g=d>c+u.length;return{users:u,isNext:g}}catch(e){throw console.log(e),e}}async function toggleSaveQuestion(e){try{(0,r.v)();let{userId:t,questionId:a,path:s}=e,c=await o.Z.findById(t);if(!c)throw Error("User not found");let l=c.saved.includes(a);l?await o.Z.findByIdAndUpdate(t,{$pull:{saved:a}},{new:!0}):await o.Z.findByIdAndUpdate(t,{$addToSet:{saved:a}},{new:!0}),(0,n.revalidatePath)(s)}catch(e){throw console.log(e),e}}async function getSavedQuestions(e){try{(0,r.v)();let{clerkId:t,searchQuery:a,filter:s,page:n=1,pageSize:c=20}=e,i=a?{title:{$regex:RegExp(a,"i")}}:{},u={};switch(s){case"most_recent":u={createdAt:-1};break;case"oldest":u={createdAt:1};break;case"most_voted":u={upvotes:-1};break;case"most_viewed":u={views:-1};break;case"most_answered":u={answers:-1}}let d=await o.Z.findOne({clerkId:t}).populate({path:"saved",match:i,options:{sort:u,skip:(n-1)*c,limit:c+1},populate:[{path:"tags",model:l.Z,select:"_id name"},{path:"author",model:o.Z,select:"_id clerkId name picture"}]}),g=d.saved.length>c;if(!d)throw Error("User not found");let f=d.saved;return{questions:f,isNext:g}}catch(e){throw console.log(e),e}}async function getUserInfo(e){try{await (0,r.v)();let{userId:t}=e;console.log("userId",t);let a=await o.Z.findOne({userId:t});if(console.log(a),!a)throw console.log("Error at get user info"),Error("User not found");let s=await c.Z.countDocuments({author:a._id}),n=await i.Z.countDocuments({author:a._id}),[l]=await c.Z.aggregate([{$match:{author:a._id}},{$project:{_id:0,upvotes:{$size:"$upvotes"}}},{$group:{_id:null,totalUpvotes:{$sum:"$upvotes"}}}]),[d]=await i.Z.aggregate([{$match:{author:a._id}},{$project:{_id:0,upvotes:{$size:"$upvotes"}}},{$group:{_id:null,totalUpvotes:{$sum:"$upvotes"}}}]),[g]=await i.Z.aggregate([{$match:{author:a._id}},{$group:{_id:null,totalViews:{$sum:"$views"}}}]),f=[{type:"QUESTION_COUNT",count:s},{type:"ANSWER_COUNT",count:n},{type:"QUESTION_UPVOTES",count:l?.totalUpvotes||0},{type:"ANSWER_UPVOTES",count:d?.totalUpvotes||0},{type:"TOTAL_VIEWS",count:g?.totalViews||0}],U=(0,u.gI)({criteria:f});return{user:a,totalQuestions:s,totalAnswers:n,badgeCounts:U,reputation:a.reputation}}catch(e){throw console.log("Error at get user info",e),e}}async function getUserQuestions(e){try{(0,r.v)();let{userId:t,page:a=1,pageSize:s=10}=e,o=(a-1)*s,n=await c.Z.countDocuments({author:t}),l=await c.Z.find({author:t}).sort({createdAt:-1,views:-1,upvotes:-1}).skip(o).limit(s).populate("tags","_id name").populate("author","_id clerkId name picture"),i=n>o+l.length;return{totalQuestions:n,questions:l,isNextQuestions:i}}catch(e){throw console.log(e),e}}async function getUserAnswers(e){try{(0,r.v)();let{userId:t,page:a=1,pageSize:s=10}=e,o=(a-1)*s,n=await i.Z.countDocuments({author:t}),c=await i.Z.find({author:t}).sort({upvotes:-1}).skip(o).limit(s).populate("question","_id title").populate("author","_id clerkId name picture"),l=n>o+c.length;return{totalAnswers:n,answers:c,isNextAnswer:l}}catch(e){throw console.log(e),e}}(0,a(51419).h)([getUserById,createUser,updateUser,deleteUser,getAllUsers,toggleSaveQuestion,getSavedQuestions,getUserInfo,getUserQuestions,getUserAnswers]),(0,s.U)("b503f13544810a33148e7c34a6812ce0d395f5c8",null,getUserById),(0,s.U)("78a0a46e75d4cf6813e57d2afedc5dcb2244db00",null,createUser),(0,s.U)("5c621a523ca335f7a4fdc4f490a3444b2c806302",null,updateUser),(0,s.U)("13e01171801b59e03215dca63c1b2331bc1fab3e",null,deleteUser),(0,s.U)("b3e9ecaf8f5e5f4e8093df72d2f88cbf0ae6f661",null,getAllUsers),(0,s.U)("2792dad0e5408251502e076a53f6a4774bfac168",null,toggleSaveQuestion),(0,s.U)("369e4a5bbceb62c6ae0599c4ff93514d8854d35a",null,getSavedQuestions),(0,s.U)("81f401ff61a085954b31f70f6863678c1049f76f",null,getUserInfo),(0,s.U)("73502c278621be22fea7ac7a07fc1052ef701654",null,getUserQuestions),(0,s.U)("2c17312b1725079b6daefcefd632aa5dade1f969",null,getUserAnswers)}};